<!DOCTYPE html>
<html lang="en">
<head>
    <title>Оформления билета | Sleeping Owl administrator</title>
    <meta charset="utf-8" />
    <meta content="klrsMsf8khPKLzr8ZQ5qvOJOf8QEirmhIaEvrAUK" name="csrf-token" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <link media="all" type="text/css" rel="stylesheet" href="http://gp41.ru/packages/sleepingowl/default/css/admin-app.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .btn[disabled]{  background: #9C9C9C;  }
        .btn-sm{ background: #e2e6ea }
    </style>
</head>
<body class="skin-blue sidebar-mini">
<div class="wrapper" id="app">
    <header class="main-header">
        <a href="http://gp41.ru/admin" class="logo">
            <span class="logo-lg"><svg style="padding:10px;" class="pull-left" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 216.123 216.123" style="enable-background:new 0 0 216.123 216.123;" xml:space="preserve" width="48px" height="48px"><g><path d="M173.65,106.51c6.549-7.024,10.567-16.436,10.567-26.774c0-8.585-2.775-16.529-7.464-23.001   c5.319-16.633,5.063-34.71-0.795-51.16L173.974,0l-5.827,1.03c-12.002,2.121-23.325,6.931-33.201,14.037H81.537v0.252   C71.577,8.071,60.122,3.176,47.977,1.03L42.149,0l-1.985,5.575c-5.858,16.45-6.114,34.527-0.795,51.16   c-4.689,6.472-7.464,14.417-7.464,23.001c0,10.338,4.018,19.75,10.567,26.773c-1.028,0.797-1.846,1.88-2.308,3.179   c-10.874,30.534-2.352,64.292,21.71,86c1.048,0.945,2.171,1.862,3.332,2.761v10.673c0,3.866,3.134,7,7,7s7-3.134,7-7v-2.194   c8.347,3.957,17.834,6.887,27.532,8.373c0.352,0.054,0.706,0.081,1.06,0.081s0.708-0.027,1.06-0.081   c4.446-0.681,16.123-2.878,28.059-8.434v2.255c0,3.866,3.134,7,7,7s7-3.134,7-7v-10.656c1.139-0.883,2.254-1.805,3.332-2.777   c24.062-21.709,32.583-55.466,21.71-86C175.496,108.389,174.678,107.306,173.65,106.51z M107.969,152.066   c-4.506-10.226-11.165-19.465-19.743-27.206c-2.717-2.451-5.583-4.7-8.571-6.748c13.12-2.887,23.804-12.341,28.406-24.734   c4.602,12.393,15.286,21.847,28.406,24.734c-2.988,2.048-5.854,4.297-8.57,6.748C119.346,132.575,112.595,141.88,107.969,152.066z    M71.206,54.436c13.951,0,25.301,11.35,25.301,25.301s-11.35,25.301-25.301,25.301s-25.301-11.35-25.301-25.301   S57.255,54.436,71.206,54.436z M170.218,79.736c0,13.951-11.35,25.301-25.301,25.301s-25.301-11.35-25.301-25.301   s11.35-25.301,25.301-25.301S170.218,65.786,170.218,79.736z M108.041,48.088c-3.04-6.825-7.023-13.231-11.845-19.021h23.699   C115.052,34.867,111.074,41.273,108.041,48.088z M164.562,16.17c2.468,9.767,2.65,20.018,0.566,29.875   c-5.909-3.558-12.824-5.61-20.21-5.61c-7.254,0-14.05,1.983-19.889,5.425c3.327-5.397,7.423-10.367,12.248-14.72   C145.142,24.043,154.479,18.934,164.562,16.17z M51.562,16.17c10.082,2.763,19.419,7.872,27.286,14.97   c4.792,4.324,8.877,9.293,12.205,14.695c-5.83-3.426-12.61-5.401-19.847-5.401c-7.386,0-14.301,2.051-20.21,5.61   C48.912,36.188,49.094,25.937,51.562,16.17z M51.555,120.283c10.084,2.763,19.425,7.873,27.293,14.972   c13.908,12.549,21.704,29.884,21.95,48.812v15.742c-10.093-2.564-21.543-7.294-29.546-14.514   C52.951,168.783,45.553,143.818,51.555,120.283z M144.871,185.295c-7.99,7.21-19.708,11.96-30.073,14.539v-15.766   c0.239-18.349,8.431-36.14,22.478-48.813c7.868-7.1,17.209-12.209,27.293-14.972C170.57,143.818,163.172,168.783,144.871,185.295z" fill="#FFFFFF"/><circle cx="71.206" cy="79.736" r="9.757" fill="#FFFFFF"/><circle cx="144.917" cy="79.736" r="9.757" fill="#FFFFFF"/></g></svg> <span class="pull-left">SleepingOwl</span></span>
            <span class="logo-mini"><svg style="padding:7px;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 216.123 216.123" style="enable-background:new 0 0 216.123 216.123;" xml:space="preserve" width="48px" height="48px"><g><path d="M173.65,106.51c6.549-7.024,10.567-16.436,10.567-26.774c0-8.585-2.775-16.529-7.464-23.001   c5.319-16.633,5.063-34.71-0.795-51.16L173.974,0l-5.827,1.03c-12.002,2.121-23.325,6.931-33.201,14.037H81.537v0.252   C71.577,8.071,60.122,3.176,47.977,1.03L42.149,0l-1.985,5.575c-5.858,16.45-6.114,34.527-0.795,51.16   c-4.689,6.472-7.464,14.417-7.464,23.001c0,10.338,4.018,19.75,10.567,26.773c-1.028,0.797-1.846,1.88-2.308,3.179   c-10.874,30.534-2.352,64.292,21.71,86c1.048,0.945,2.171,1.862,3.332,2.761v10.673c0,3.866,3.134,7,7,7s7-3.134,7-7v-2.194   c8.347,3.957,17.834,6.887,27.532,8.373c0.352,0.054,0.706,0.081,1.06,0.081s0.708-0.027,1.06-0.081   c4.446-0.681,16.123-2.878,28.059-8.434v2.255c0,3.866,3.134,7,7,7s7-3.134,7-7v-10.656c1.139-0.883,2.254-1.805,3.332-2.777   c24.062-21.709,32.583-55.466,21.71-86C175.496,108.389,174.678,107.306,173.65,106.51z M107.969,152.066   c-4.506-10.226-11.165-19.465-19.743-27.206c-2.717-2.451-5.583-4.7-8.571-6.748c13.12-2.887,23.804-12.341,28.406-24.734   c4.602,12.393,15.286,21.847,28.406,24.734c-2.988,2.048-5.854,4.297-8.57,6.748C119.346,132.575,112.595,141.88,107.969,152.066z    M71.206,54.436c13.951,0,25.301,11.35,25.301,25.301s-11.35,25.301-25.301,25.301s-25.301-11.35-25.301-25.301   S57.255,54.436,71.206,54.436z M170.218,79.736c0,13.951-11.35,25.301-25.301,25.301s-25.301-11.35-25.301-25.301   s11.35-25.301,25.301-25.301S170.218,65.786,170.218,79.736z M108.041,48.088c-3.04-6.825-7.023-13.231-11.845-19.021h23.699   C115.052,34.867,111.074,41.273,108.041,48.088z M164.562,16.17c2.468,9.767,2.65,20.018,0.566,29.875   c-5.909-3.558-12.824-5.61-20.21-5.61c-7.254,0-14.05,1.983-19.889,5.425c3.327-5.397,7.423-10.367,12.248-14.72   C145.142,24.043,154.479,18.934,164.562,16.17z M51.562,16.17c10.082,2.763,19.419,7.872,27.286,14.97   c4.792,4.324,8.877,9.293,12.205,14.695c-5.83-3.426-12.61-5.401-19.847-5.401c-7.386,0-14.301,2.051-20.21,5.61   C48.912,36.188,49.094,25.937,51.562,16.17z M51.555,120.283c10.084,2.763,19.425,7.873,27.293,14.972   c13.908,12.549,21.704,29.884,21.95,48.812v15.742c-10.093-2.564-21.543-7.294-29.546-14.514   C52.951,168.783,45.553,143.818,51.555,120.283z M144.871,185.295c-7.99,7.21-19.708,11.96-30.073,14.539v-15.766   c0.239-18.349,8.431-36.14,22.478-48.813c7.868-7.1,17.209-12.209,27.293-14.972C170.57,143.818,163.172,168.783,144.871,185.295z" fill="#FFFFFF"/><circle cx="71.206" cy="79.736" r="9.757" fill="#FFFFFF"/><circle cx="144.917" cy="79.736" r="9.757" fill="#FFFFFF"/></g></svg></span>
        </a>

        <nav class="navbar navbar-static-top" role="navigation">
            <!-- Sidebar toggle button-->
            <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                <span class="sr-only">Toggle navigation</span>
            </a>
            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">
                </ul>

                <ul class="nav navbar-nav navbar-right">
                    @if ($user->id)
                        <li class="dropdown user user-menu" style="margin-right: 20px;">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                                <img src="{{ $user->avatar_url_or_blank }}" class="user-image" />
                                <span class="hidden-xs">{{ $user->name }}</span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header">
                                    <p>
                                        {{ $user->name }}
                                        <small>Зарегистрирован {{$user->created_at->format('d.m.Y')}}</small>
                                    </p>
                                </li>
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <a href="{{ route('logout') }}"  onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
                                        <i class="fa fa-btn fa-sign-out"></i> Выйти
                                    </a>
                                    <form id="logout-form" action="{{ route('logout') }}" method="POST" style="display: none;">
                                        {{ csrf_field() }}
                                    </form>
                                </li>
                            </ul>
                        </li>
                    @endif
                </ul>
            </div>
        </nav>
    </header>

    <aside class="main-sidebar">
        <section class="sidebar">
            <ul class="sidebar-menu">

                <li >
                    <a href="http://gp41.ru/admin/flights">
                        <i class="fa fa-exchange"></i>
                        <span>Маршруты</span>
                    </a>
                </li>

                <li >
                    <a href="http://gp41.ru/admin/buses">
                        <i class="fa fa-bus"></i>
                        <span>Автобусы</span>

                    </a>
                </li>

                <li >
                    <a href="http://gp41.ru/admin/stations">
                        <i class="fa fa-map-marker"></i>
                        <span>Станции</span>

                    </a>
                </li>

                <li  class="active">
                    <a href="http://gp41.ru/admin/orders">
                        <i class="fa fa-ticket"></i>
                        <span>Заказы</span>

                    </a>
                </li>

                <li  class="has-child">
                    <a href="#" >
                        <i class="fa fa-group"></i>
                        <span>Пользователи</span>
                        <span class="pull-right-container"><i class="fa fa-angle-left pull-right"></i></span>
                    </a>

                    <ul class="treeview-menu">
                        <li >
                            <a href="http://gp41.ru/admin/users">
                                <i class="fa fa-user"></i>
                                <span>Сотрудники</span>

                            </a>
                        </li>

                        <li >
                            <a href="http://gp41.ru/admin/roles">
                                <i class="fa fa-group"></i>
                                <span>Роли</span>

                            </a>
                        </li>

                    </ul>
                </li>

                <li >
                    <a href="http://gp41.ru/admin/pages">
                        <i class="fa fa-pencil"></i>
                        <span>Страницы</span>

                    </a>
                </li>

                <li >
                    <a href="http://gp41.ru/admin/settings/1/edit">
                        <i class="fa fa-cogs"></i>
                        <span>Настройки</span>

                    </a>
                </li>

                <li >
                    <a href="http://gp41.ru/admin">
                        <i class="fa fa-dashboard"></i>
                        <span>Dashboard</span>

                    </a>
                </li>


                @if(!$user->isCashier())
                    <li >
                        <a href="http://gp41.ru/admin/stat">
                            <i class="fa fa-eye"></i>
                            <span>Статистика</span>
                        </a>
                    </li>
                @endif

                <li >
                    <a href="http://gp41.ru/admin/user_histories">
                        <i class="fa fa-history"></i>
                        <span>История изменения</span>

                    </a>
                </li>

            </ul>

        </section>
    </aside>

    <div class="content-wrapper">
        <ol class="breadcrumb">
            <li><a href="http://gp41.ru/admin">Панель</a></li>
            <li><a href="http://gp41.ru/admin/orders">Заказы</a></li>
            <li class="active">Оформления билета</li>
        </ol>

        <div class="content-header"><h1>Оформления билета</h1></div>

        <div class="content body">
            <div class="form-elements">
                <div class="panel-body">
                    @php $places = $data->buses->places; $num = $places  / 4; $sr = round($num); @endphp
                    <form method="post" action="/admin/orders/create">
                        {{csrf_field()}}
                        <div class="row">
                            <h4 class="text-center">Выберите {{$count > 1 ? 'места' : 'место'}}</h4>
                            <div class="col-md-offset-3 col-md-2">
                                <table class="table mtd ">
                                    <tr>
                                        <td rowspan="5" >
                                            <i class="fa fa-user"></i>
                                        </td>
                                        <td>
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm"
                                                v-bind:class="isSelected({{$places}})" v-on:click="select({{$places}})"
                                                :disabled="isDisabled({{$places}}, {{ in_array($places, $arrPlaces) ? true : false}})">{{$places}}
                                       </button>
                                        <input type="checkbox" class="hidden" name="places[]" v-model="inputs" value="{{ $places }}" />

                                    </span>
                                        </td>
                                        @for($i = 4; $i < $places - 4; $i+= 4)
                                            @if($num < $sr &&  $i == $places - 7)
                                                <td></td>
                                                <td>
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm"
                                                v-bind:class="isSelected({{$i + 3}})" v-on:click="select({{$i + 3}})"
                                                :disabled="isDisabled({{$i + 3}}, {{ in_array($i + 3,$arrPlaces) ? true : false}})">{{$i + 3}}
                                        </button>
                                        <input type="checkbox" class="hidden" name="places[]" v-model="inputs" value="{{$i + 3}}" />
                                    </span>
                                                </td>
                                                @break
                                            @endif
                                            <td>
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm" v-bind:class="isSelected({{$i == ($places - 5) ? $i + 1 : $i }})"
                                                v-on:click="select({{$i == ($places - 5) ? $i + 1 : $i }})"
                                                :disabled="isDisabled({{$i == ($places - 5) ? $i + 1 : $i }}, {{ in_array($i,$arrPlaces) ? true : false}})">{{$i == ($places - 5) ? $i + 1 : $i }}
                                        </button>
                                        @if(!in_array($i, $arrPlaces))<input type="checkbox" value="{{$i}}" name="places[]"  v-model="inputs" class="hidden" /> @endif
                                    </span>
                                            </td>
                                        @endfor
                                    </tr>
                                    <tr>
                                        <td class="col-md-1">
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm"
                                                v-bind:class="isSelected({{$places - 1}})" v-on:click="select({{$places - 1}})"
                                                :disabled="isDisabled({{$places - 1}}, {{ in_array($i,$arrPlaces) ? true : false}})">{{$places - 1}}
                                       </button>
                                        <input type="checkbox" class="hidden" name="places[]" v-model="inputs" value="{{ $places - 1 }}" />
                                    </span>
                                        </td>
                                        @for($i = 3; $i < $places - 4; $i+= 4)
                                            @if($num < $sr &&  $i == $places - 8)
                                                <td></td>
                                                <td>
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm"
                                                v-bind:class="isSelected({{$i + 3}})" v-on:click="select({{$i + 3}})"
                                                :disabled="isDisabled({{$i + 3}}, {{ in_array($i + 3,$arrPlaces) ? true : false}})">{{$i + 3}}
                                        </button>
                                        @if(!in_array($i + 3,$arrPlaces)) <input type="checkbox" class="hidden" v-model="inputs" name="places[]" value="{{$i + 3}}" />@endif
                                    </span>
                                                </td>
                                                @break
                                            @endif
                                            <td>
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm"
                                                v-bind:class="isSelected({{$i == ($places - 6) ? $i + 1 : $i }})" v-on:click="select({{$i == ($places - 6) ? $i + 1 : $i }})"
                                                :disabled="isDisabled({{$i == ($places - 6) ? $i + 1 : $i }}, {{ in_array($i,$arrPlaces) ? true : false}})">{{$i == ($places - 6) ? $i + 1 : $i }}
                                        </button>
                                        @if(!in_array($i,$arrPlaces)) <input type="checkbox" class="hidden" v-model="inputs" name="places[]" value="{{  $i }}" />@endif
                                    </span>
                                            </td>
                                        @endfor
                                    </tr>
                                    <tr>
                                        <td colspan="{{  $sr - 1 }}"></td>
                                        <td>
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm"
                                                v-bind:class="isSelected({{$places - 6}})" v-on:click="select({{$places - 6}})"
                                                :disabled="isDisabled({{$places - 6}}, {{ in_array($places - 6,$arrPlaces) ? true : false}})">{{  $places - 6 }}
                                        </button>
                                        <input type="checkbox" class="hidden" name="places[]" v-model="inputs" value="{{$places - 6 }}" />
                                    </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                    <span class="button-checkbox">
                                            <button type="button" class="btn btn-sm"
                                                    v-bind:class="isSelected({{$places - 2}})" v-on:click="select({{$places - 2}})"
                                                    :disabled="isDisabled({{$places - 2}}, {{ in_array($places - 2,$arrPlaces) ? true : false}})">{{ $places - 2 }}
                                          </button>
                                            <input type="checkbox" class="hidden" name="places[]" v-model="inputs" value="{{$places - 2 }}" />
                                    </span>
                                        </td>
                                        @for($i = 2; $i < $places - 4; $i+= 4)
                                            @if($num < $sr &&  $i == $places - 5)
                                                <td>
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm"
                                                v-bind:class="isSelected({{$i - 2}})" v-on:click="select({{$i - 2}})"
                                                :disabled="isDisabled({{$i - 2}}, {{ in_array($i-2,$arrPlaces) ? true : false}})">{{ $i - 2 }}
                                        </button>
                                        <input type="checkbox" class="hidden" name="places[]" v-model="inputs"  value="{{ $i - 2 }}" /></span>
                                                </td>
                                                @break
                                            @endif
                                            <td>
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm"
                                                v-bind:class="isSelected({{$i}})" v-on:click="select({{$i}})"
                                                :disabled="isDisabled({{$i}}, {{ in_array($i,$arrPlaces) ? true : false}})">{{ $i }}
                                        </button>
                                        <input type="checkbox" class="hidden" name="places[]" v-model="inputs"  value="{{ $i }}" />
                                    </span>
                                            </td>
                                        @endfor
                                    </tr>
                                    <tr>
                                        <td>
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm"
                                                v-bind:class="isSelected({{$places - 3}})" v-on:click="select({{$places - 3}})"
                                                :disabled="isDisabled({{$places - 3}}, {{ in_array($places - 3,$arrPlaces) ? true : false}})">{{$places - 3}}
                                        </button>
                                        <input type="checkbox" class="hidden" v-model="inputs" name="places[]" value="{{$places - 3 }}" />
                                    </span>
                                        </td>
                                        @for($i = 1; $i < $places - 4; $i+=4)
                                            @if($num < $sr &&  $i == $places - 6)
                                                <td>
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm"
                                                v-bind:class="isSelected({{$i - 2}})" v-on:click="select({{$i - 2}})"
                                                :disabled="isDisabled({{$i - 2}}, {{ in_array($i - 2,$arrPlaces) ? true : false}})">{{ $i - 2 }}
                                        </button>
                                        <input type="checkbox" class="hidden" v-model="inputs"  name="places[]" value=">{{ $i - 2 }}" />
                                    </span>
                                                </td>
                                                @break;
                                            @endif
                                            <td>
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-sm"
                                                v-bind:class="isSelected({{$i}})" v-on:click="select({{$i}})"
                                                :disabled="isDisabled({{$i}}, {{ in_array($i,$arrPlaces) ? true : false}})">{{ $i }}
                                        </button>
                                        <input type="checkbox" class="hidden" v-model="inputs"  name="places[]" value="{{$i}}" />
                                    </span>
                                            </td>
                                        @endfor
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="row after-add-more">
                            <h4>Данные пассажиров</h4>
                            @if ($errors->has('places'))
                                <span class="help-block"><strong>{{ $errors->first('places') }}</strong></span>
                            @endif
                            @for($i = 0; $i < $count; $i++)
                                <fieldset><legend>Пассажир #{{$i+1}}:</legend>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="form-elements">
                                                <div class="form-group form-element-text {!! $errors->has("last_name.".$i) ? ' has-error' : '' !!}">
                                                    <label class="control-label" for="last_name">Фамилия <span class="form-element-required">*</span></label>
                                                    <input class="form-control" type="text" id="last_name" name="last_name[{{$i}}]" value="">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group {!! $errors->has("name.".$i) ? ' has-error' : '' !!}">
                                                <label class="control-label" for="name">Имя <span class="form-element-required">*</span></label>
                                                <input class="form-control" type="text" id="name" name="name[{{$i}}]" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group {!! $errors->has("middle_name.".$i) ? ' has-error' : '' !!}">
                                                <label class="control-label" for="middle_name">Отчество <span class="form-element-required">*</span></label>
                                                <input class="form-control" type="text" id="middle_name" name="middle_name[{{$i}}]" value="">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group {!! $errors->has("passport.".$i) ? ' has-error' : '' !!}">
                                                <label for="passport" class="control-label ">Паспорт <span class="form-element-required">*</span></label>
                                                <input  class="form-control" type="text" id="passport" name="passport[{{$i}}]" value="" >
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="checkbox">
                                                <label><input class="children" type="checkbox" name="children[{{$i}}]"
                                                              v-model="childrens[{{$i}}]"
                                                              :disabled="cashless[{{$i}}] == true"
                                                              value="1">
                                                    <strong>Детский (%50)</strong></label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="checkbox">
                                                <label><input class="cashless" type="checkbox" name="cashless[{{$i}}]"
                                                              v-model="cashless[{{$i}}]"
                                                              :disabled="childrens[{{$i}}] == true"
                                                              value="1">
                                                    <strong>По безналу (%100)</strong></label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-3">
                                            <label class="control-label {!! $errors->has("baggage.".$i."person") ? ' has-error' : '' !!}">Есть багаж ? <span class="form-element-required">*</span></label>
                                            <select class="form-control mselect" name="baggage[{{$i}}][person]">
                                                <option value="yes">Да</option>
                                                <option selected value="no">Нет</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="control-label">Количество мест (сумок) <span class="form-element-required">*</span></label>
                                            <select class="form-control mselect2" name="baggage[{{$i}}][place]"
                                                    v-model="baggage_place[{{$i}}]"
                                                    data-price="{{$data->price->first()->price}}"
                                                    data-sum="{{$data->price->first()->price * $count }}"
                                                    v-on:change="bselect"
                                                    disabled>
                                                <option value="0" disabled selected>Выбрать</option>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <p class="help-block">Одно место бесплатно, последующие 20% от стоимости проезда. багаж у водителя можно получить только при наличии квитанции (электронного билета), в котором сказано  количество багажа</p>
                                        </div>
                                    </div>
                                </fieldset>
                            @endfor
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group {!! $errors->has("phone") ? ' has-error' : '' !!}">
                                        <label for="phone" class="control-label ">Телефон <small>(один номер)</small><span class="form-element-required">*</span></label>
                                        <input  class="form-control" type="text" id="phone" name="phone" value="" >
                                    </div>
                                </div>
                            </div>
                        </div>

                        <input type="hidden" name="departure" value="{{date('H:i',strtotime($data->stations->first()->pivot->departure))}}">
                        <input type="hidden" name="arrival" value="{{date('H:i',strtotime($data->stations->last()->pivot->arrival))}}">
                        <input type="hidden"  name="price"  value="{{$data->price->first()->price}}">
                        <input type="hidden" id="allsuma" name="suma"  value="{{$data->price->first()->price}}">

                        <h5 style="">Стоимость билетов<small>(без багажа)</small>:
                            <input type="text" v-model="priceTickets" disabled>
                        </h5>
                        <h5 style="">Стоимость перевозки багажа:
                            <input type="text" v-model="bsuma" disabled>
                        </h5>
                        <h3 style="">Общая стоимость:
                            <input type="text" v-model="total" disabled>
                        </h3>
                        <button class="btn btn-success">Оформить билеты</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{asset(('js/jquery-3.2.1.js'))}}"></script>
<script src="{{asset('/js/vue2.js')}}"></script>

<script>

    var k = 0;

    new Vue({
        el:'#app',
        data:{
            inputs:[],
            published:false,
            personal:false,
            places: {{$count}},
            ticketPrice: {{$data->price->first()->price }},
            baggage_place:[],
            bsuma:0,
            childrens:[],
            cashless:[]

        },

        computed: {
            btn: function () {
                return this.published && this.personal
            },

            priceTickets: function(){
                return (this.places * this.ticketPrice)
                    - this.countCheckbox(this.childrens, this.cashless, 0.50) + ' RUB';
            },

            total:function(){
                return (this.places * this.ticketPrice)
                    - this.countCheckbox(this.childrens, this.cashless, 0.50)
                    + this.bsuma + ' RUB';

            }
        },

        methods:{
            countCheckbox:function(childrens, cashless, percent){
                let k  = 0;
                let k2  = 0;
                let price = 0;

                for (var i = 0; i < childrens.length; i++){
                    if(childrens[i]){
                        k++;
                    }
                }

                for (var i = 0; i < cashless.length; i++){
                    if(cashless[i]){
                        k2++;
                    }
                }

                if(k2 == 0 && k > 0) {
                    return (this.ticketPrice * k * percent);
                }else if(k == 0 && k2 > 0){
                    return this.ticketPrice * k2;
                }else{
                    return (this.ticketPrice * k2) + (this.ticketPrice * k * percent);
                }

                //return price > 0 ? price : 0;

            },

            bselect:function(){
                let suma = 0;
                for(var i= 0; i < this.baggage_place.length; i++){
                    if(this.baggage_place[i] > 1){
                        suma  += (this.ticketPrice * 0.20) * (this.baggage_place[i] - 1);
                    }
                }

                this.bsuma = suma;

            },


            select:function(index){
                if(this.getIndex(index) == 0){
                    this.inputs.push(index);
                }else{
                    this.getIndex(index);
                }
            },

            isSelected:function(index){
                return this.inputs.indexOf(index) != -1 ? 'btn-primary' : '';
            },

            isDisabled:function(index, flag){
                return (this.inputs.length == this.places && this.inputs.indexOf(index) == -1) || flag == 1;
            },

            getIndex:function(value){
                for(var i in this.inputs){
                    if(this.inputs[i] == value){
                        return this.inputs.splice(i, 1);
                    }
                }
                return 0;
            }
        }

    });

    $(document).on('change', '.mselect' ,function(){
        if($(this).val() == 'yes') {
            $(this).parent().next().find('select').removeAttr('disabled');
            var selected = $(this).parent().next().find('select');
            updatePrice(selected.data('price'), selected.val(), selected.data('sum'));
        }else{
            $(this).parent().next().find('select').attr('disabled', 'disabled');
            $(this).parent().next().find('select').val('0').prop('selected', true);
            //$('.price').text(currentPrice + ' RUB');
        }

    });

</script>
</body>
</html>
